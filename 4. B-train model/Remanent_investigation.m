%% Eddy current analysis
% Christian Grech - 13.03.2019 - TE-MSC-MM

%% Clear Variables, Close Current Figures
clc;
clear all;
close all;
load('parameter_p');
f=1e3; j=1; dt1 = 16e3; dt2=6e3; dt3 = 10e3
%% Load data
% t1=270000:381500;  t2=260000:420000;  t3=310000:470000;  t4=340000:540000;  t5=380000:600000;  t6=430000:700000;  t7=450000:690000; 
% t1=1:f;  t2=1:f;  t3=1:f;  t4=1:f;  t5=1:f;  t6=1:f;  t7=1:f; 
load('data/Cycle_40A_100As_processed.mat');
I40_100 = curr;B40_100 = BdL;t40 = tim; s1 = 1.062e5; s2 = 2.022e5; s3=2.982e5; s4=3.815e5;
B40_100_1 = mean(B40_100((s1-dt1):(s1-dt2)));  B40_100_2 = mean(B40_100((s2-dt1):(s2-dt2))); B40_100_3 = mean(B40_100((s3-dt1):(s3-dt2))); B40_100_4 = mean(B40_100((s4-dt3):s4)); 
load('data/Cycle_50A_100As_processed.mat'); 
I50_100 = curr;B50_100 = BdL;s1 = 8.89e4; s2 = 1.89e5; s3=2.89e5; s4=4.24e5;
B50_100_1 = mean(B50_100((s1-dt1):(s1-dt2)));  B50_100_2 = mean(B50_100((s2-dt1):(s2-dt2))); B50_100_3 = mean(B50_100((s3-dt1):(s3-dt2))); B50_100_4 = mean(B50_100((s4-dt3):s4)); 
load('data/Cycle_100A_100As_processed.mat'); 
I100_100 = curr;B100_100 = BdL; s1 = 9.612e4; s2 = 2.162e5; s3=3.362e5; s4=4.75e5;
B100_100_1 = mean(B100_100((s1-dt1):(s1-dt2)));  B100_100_2 = mean(B100_100((s2-dt1):(s2-dt2))); B100_100_3 = mean(B100_100((s3-dt1):(s3-dt2))); B100_100_4 = mean(B100_100((s4-dt3):s4)); 
load('data/Cycle_150A_100As_processed.mat'); 
I150_100 = curr;B150_100 = BdL; s1 = 9.193e4; s2 = 2.32e5; s3=3.7e5; s4=5.45e5;
B150_100_1 = mean(B150_100((s1-dt1):(s1-dt2)));  B150_100_2 = mean(B150_100((s2-dt1):(s2-dt2))); B150_100_3 = mean(B150_100((s3-dt1):(s3-dt2))); B150_100_4 = mean(B150_100((s4-dt3):s4)); 
load('data/Cycle_200A_100As_processed.mat');
I200_100 = curr;B200_100 = BdL; s1 = 9.29e4; s2 = 2.53e5; s3=4.13e5; s4=6.23e5;
B200_100_1 = mean(B200_100((s1-dt1):(s1-dt2)));  B200_100_2 = mean(B200_100((s2-dt1):(s2-dt2))); B200_100_3 = mean(B200_100((s3-dt1):(s3-dt2))); B200_100_4 = mean(B200_100((s4-dt3):s4)); 
load('data/Cycle_250A_100As_processed.mat'); 
I250_100 = curr;B250_100 = BdL; s1 = 9.62e4; s2 =2.77e5; s3=4.57e5; s4=7.34e5;
B250_100_1 = mean(B250_100((s1-dt1):(s1-dt2)));  B250_100_2 = mean(B250_100((s2-dt1):(s2-dt2))); B250_100_3 = mean(B250_100((s3-dt1):(s3-dt2))); B250_100_4 = mean(B250_100((s4-dt3):s4));
load('data/Cycle_276A_100As_processed.mat'); 
I276_100 = curr;B276_100 = BdL; s1 = 9.14e4; s2 = 2.8e5; s3=4.72e5; s4=6.98e5;
B276_100_1 = mean(B276_100((s1-dt1):(s1-dt2)));  B276_100_2 = mean(B276_100((s2-dt1):(s2-dt2))); B276_100_3 = mean(B276_100((s3-dt1):(s3-dt2))); B276_100_4 = mean(B276_100((s4-dt3):s4));
% t1=250000:390000;  t2=270000:440000;  t3=300000:470000;  t4=300000:470000;  t5=320000:500000;  t6=340000:520000; 

load('data/Cycle_40A_200As_processed.mat');
I40_200 = curr;B40_200 = BdL;
s1 = 9.19e4; s2 = 1.8e5; s3=2.682e5; s4=3.91e5;
B40_200_1 = mean(B40_200((s1-dt1):(s1-dt2)));  B40_200_2 = mean(B40_200((s2-dt1):(s2-dt2))); B40_200_3 = mean(B40_200((s3-dt1):(s3-dt2))); B40_200_4 = mean(B40_200((s4-dt3):s4)); 
load('data/Cycle_50A_200As_processed.mat'); 
I50_200 = curr;B50_200 = BdL; s1 = 8.47e4; s2 = 1.74e5; s3=2.647e5; s4=4.1e5;
B50_200_1 = mean(B50_200((s1-dt1):(s1-dt2)));  B50_200_2 = mean(B50_200((s2-dt1):(s2-dt2))); B50_200_3 = mean(B50_200((s3-dt1):(s3-dt2))); B50_200_4 = mean(B50_200((s4-dt3):s4)); 
load('data/Cycle_100A_200As_processed.mat'); 
I100_200 = curr;B100_200 = BdL;  s1 = 8.95e4; s2 = 1.914e5; s3=2.914e5; s4=4.4e5;
B100_200_1 = mean(B100_200((s1-dt1):(s1-dt2)));  B100_200_2 = mean(B100_200((s2-dt1):(s2-dt2))); B100_200_3 = mean(B100_200((s3-dt1):(s3-dt2))); B100_200_4 = mean(B100_200((s4-dt3):s4)); 
load('data/Cycle_150A_200As_processed.mat'); 
I150_200 = curr;B150_200 = BdL; s1 = 1.018e5; s2 = 2.118e5; s3=3.218e5; s4=4.85e5;
B150_200_1 = mean(B150_200((s1-dt1):(s1-dt2)));  B150_200_2 = mean(B150_200((s2-dt1):(s2-dt2))); B150_200_3 = mean(B150_200((s3-dt1):(s3-dt2))); B150_200_4 = mean(B150_200((s4-dt3):s4)); 
load('data/Cycle_200A_200As_processed.mat');
I200_200 = curr;B200_200 = BdL; s1 = 8.49e4; s2 = 2.049e5; s3=3.249e5; s4=4.95e5;
B200_200_1 = mean(B200_200((s1-dt1):(s1-dt2)));  B200_200_2 = mean(B200_200((s2-dt1):(s2-dt2))); B200_200_3 = mean(B200_200((s3-dt1):(s3-dt2))); B200_200_4 = mean(B200_200((s4-dt3):s4)); 
load('data/Cycle_250A_200As_processed.mat'); 
I250_200 = curr;B250_200 = BdL; s1 = 8.76e4; s2 = 2.173e5; s3=3.481e5; s4=5.48e5;
B250_200_1 = mean(B250_200((s1-dt1):(s1-dt2)));  B250_200_2 = mean(B250_200((s2-dt1):(s2-dt2))); B250_200_3 = mean(B250_200((s3-dt1):(s3-dt2))); B250_200_4 = mean(B250_200((s4-dt3):s4));
load('data/Cycle_276A_200As_processed.mat'); 
I276_200 = curr;B276_200 = BdL; s1 = 8.86e4; s2 = 2.246e5; s3=3.598e5; s4=5.52e5;
B276_200_1 = mean(B276_200((s1-dt1):(s1-dt2)));  B276_200_2 = mean(B276_200((s2-dt1):(s2-dt2))); B276_200_3 = mean(B276_200((s3-dt1):(s3-dt2))); B276_200_4 = mean(B276_200((s4-dt3):s4));

% 
% t1=240000:366000;  t2=240000:390000;  t3=240000:420000;  t4=240000:400000;  t5=260000:440000;  t6=260000:400000;  t7=300000:450000; 
load('data/Cycle_40A_500As_processed.mat');
I40_500 = curr;B40_500 = BdL;  s1 = 9.616e4; s2 = 1.794e5; s3=2.626e5; s4=3.66e5;
B40_500_1 = mean(B40_500((s1-dt1):(s1-dt2)));  B40_500_2 = mean(B40_500((s2-dt1):(s2-dt2))); B40_500_3 = mean(B40_500((s3-dt1):(s3-dt2))); B40_500_4 = mean(B40_500((s4-dt3):s4)); 
load('data/Cycle_50A_500As_processed.mat'); 
I50_500 = curr;B50_500 = BdL;  s1 = 1.048e5; s2 = 1.884e5; s3=2.728e5; s4=3.9e5;
B50_500_1 = mean(B50_500((s1-dt1):(s1-dt2)));  B50_500_2 = mean(B50_500((s2-dt1):(s2-dt2))); B50_500_3 = mean(B50_500((s3-dt1):(s3-dt2))); B50_500_4 = mean(B50_500((s4-dt3):s4)); 
load('data/Cycle_100A_500As_processed.mat'); 
I100_500 = curr;B100_500 = BdL;  s1 = 9.124e4; s2 = 1.792e5; s3=2.672e5; s4=4.49e5;
B100_500_1 = mean(B100_500((s1-dt1):(s1-dt2)));  B100_500_2 = mean(B100_500((s2-dt1):(s2-dt2))); B100_500_3 = mean(B100_500((s3-dt1):(s3-dt2))); B100_500_4 = mean(B100_500((s4-dt3):s4)); 
load('data/Cycle_150A_500As_processed.mat'); 
I150_500 = curr;B150_500 = BdL;  s1 = 8.816e4; s2 = 1.802e5; s3=2.722e5; s4=4.13e5;
B150_500_1 = mean(B150_500((s1-dt1):(s1-dt2)));  B150_500_2 = mean(B150_500((s2-dt1):(s2-dt2))); B150_500_3 = mean(B150_500((s3-dt1):(s3-dt2))); B150_500_4 = mean(B150_500((s4-dt3):s4)); 
load('data/Cycle_200A_500As_processed.mat');
I200_500 = curr;B200_500 = BdL;  s1 = 9.068e4; s2 = 1.867e5; s3=2.827e5; s4=4.45e5;
B200_500_1 = mean(B200_500((s1-dt1):(s1-dt2)));  B200_500_2 = mean(B200_500((s2-dt1):(s2-dt2))); B200_500_3 = mean(B200_500((s3-dt1):(s3-dt2))); B200_500_4 = mean(B200_500((s4-dt3):s4)); 
load('data/Cycle_250A_500As_processed.mat'); 
I250_500 = curr;B250_500 = BdL;  s1 = 9.09e4; s2 = 1.909e5; s3=2.909e5; s4=4.129e5;
B250_500_1 = mean(B250_500((s1-dt1):(s1-dt2)));  B250_500_2 = mean(B250_500((s2-dt1):(s2-dt2))); B250_500_3 = mean(B250_500((s3-dt1):(s3-dt2))); B250_500_4 = mean(B250_500((s4-dt3):s4)); 
load('data/Cycle_276A_500As_processed.mat'); 
I276_500 = curr;B276_500 = BdL; s1 = 1.136e5; s2 = 2.157e5; s3=3.178e5; s4=4.618e5;
B276_500_1 = mean(B276_500((s1-dt1):(s1-dt2)));  B276_500_2 = mean(B276_500((s2-dt1):(s2-dt2))); B276_500_3 = mean(B276_500((s3-dt1):(s3-dt2))); B276_500_4 = mean(B276_500((s4-dt3):s4)); 

% t1=220000:323500;  t2=230000:400000;  t3=240000:460000;  t4=240000:370000;  t5=240000:382000;  t6=240000:400000;  t7=250000:424000; 
load('data/Cycle_40A_900As_processed.mat');
I40_900 = curr;B40_900 = BdL; s1 = 8.752e4; s2 = 1.693e5; s3=2.511e5; s4=3.235e5;
B40_900_1 = mean(B40_900((s1-dt1):(s1-dt2)));  B40_900_2 = mean(B40_900((s2-dt1):(s2-dt2))); B40_900_3 = mean(B40_900((s3-dt1):(s3-dt2))); B40_900_4 = mean(B40_900((s4-dt3):s4)); 
load('data/Cycle_50A_900As_processed.mat'); 
I50_900 = curr;B50_900 = BdL; s1 = 9.58e4; s2 = 1.78e5; s3=2.603e5; s4=4.108e5;
B50_900_1 = mean(B50_900((s1-dt1):(s1-dt2)));  B50_900_2 = mean(B50_900((s2-dt1):(s2-dt2))); B50_900_3 = mean(B50_900((s3-dt1):(s3-dt2))); B50_900_4 = mean(B50_900((s4-dt3):s4)); 
load('data/Cycle_100A_900As_processed.mat'); 
I100_900 = curr;B100_900 = BdL; s1 = 9.522e4; s2 = 1.797e5; s3=2.641e5; s4=4.66e5;
B100_900_1 = mean(B100_900((s1-dt1):(s1-dt2)));  B100_900_2 = mean(B100_900((s2-dt1):(s2-dt2))); B100_900_3 = mean(B100_900((s3-dt1):(s3-dt2))); B100_900_4 = mean(B100_900((s4-dt3):s4)); 
load('data/Cycle_150A_900As_processed.mat'); 
I150_900 = curr;B150_900 = BdL; s1 = 8.92e4; s2 = 1.758e5; s3=2.625e5; s4=3.725e5;
B150_900_1 = mean(B150_900((s1-dt1):(s1-dt2)));  B150_900_2 = mean(B150_900((s2-dt1):(s2-dt2))); B150_900_3 = mean(B150_900((s3-dt1):(s3-dt2))); B150_900_4 = mean(B150_900((s4-dt3):s4)); 
load('data/Cycle_200A_900As_processed.mat');
I200_900 = curr;B200_900 = BdL; s1 = 8.697e4; s2 = 1.759e5; s3=2.647e5; s4=3.825e5;
B200_900_1 = mean(B200_900((s1-dt1):(s1-dt2)));  B200_900_2 = mean(B200_900((s2-dt1):(s2-dt2))); B200_900_3 = mean(B200_900((s3-dt1):(s3-dt2))); B200_900_4 = mean(B200_900((s4-dt3):s4)); 
load('data/Cycle_250A_900As_processed.mat'); 
I250_900 = curr;B250_900 = BdL;  s1 = 9.033e4; s2 = 1.814e5; s3=2.726e5; s4=4.03e5;
B250_900_1 = mean(B250_900((s1-dt1):(s1-dt2)));  B250_900_2 = mean(B250_900((s2-dt1):(s2-dt2))); B250_900_3 = mean(B250_900((s3-dt1):(s3-dt2))); B250_900_4 = mean(B250_900((s4-dt3):s4)); 
load('data/Cycle_276A_900As_processed.mat'); 
I276_900 = curr;B276_900 = BdL; s1 = 9.031e4; s2 = 1.826e5; s3=2.748e5; s4=4.24e5;
B276_900_1 = mean(B276_900((s1-dt1):(s1-dt2)));  B276_900_2 = mean(B276_900((s2-dt1):(s2-dt2))); B276_900_3 = mean(B276_900((s3-dt1):(s3-dt2))); B276_900_4 = mean(B276_900((s4-dt3):s4)); 

%%
BdL0_40_100 = mean([B40_100_1; B40_100_2; B40_100_3; B40_100_4]);  std_40_100 = std([B40_100_1; B40_100_2; B40_100_3; B40_100_4]); 
BdL0_50_100 = mean([B50_100_1; B50_100_2; B50_100_3; B50_100_4]);  std_50_100 = std([B50_100_1; B50_100_2; B50_100_3; B50_100_4]); 
BdL0_100_100 = mean([B100_100_1; B100_100_2; B100_100_3; B100_100_4]);  std_100_100 = std([B100_100_1; B100_100_2; B100_100_3; B100_100_4]); 
BdL0_150_100 = mean([B150_100_1; B150_100_2; B150_100_3; B150_100_4]);  std_150_100 = std([B150_100_1; B150_100_2; B150_100_3; B150_100_4]); 
BdL0_200_100 = mean([B200_100_1; B200_100_2; B200_100_3; B200_100_4]);  std_200_100 = std([B200_100_1; B200_100_2; B200_100_3; B200_100_4]); 
BdL0_250_100 = mean([B250_100_1;  B250_100_4]);  std_250_100 = std([B250_100_1;  B250_100_4]); 
BdL0_276_100 = mean([B276_100_1; B276_100_2; B276_100_3; B276_100_4]);  std_276_100 = std([B276_100_1; B276_100_2; B276_100_3; B276_100_4]); 

BdL0_40_200 = mean([B40_200_1; B40_200_2; B40_200_3; B40_200_4]);  std_40_200 = std([B40_200_1; B40_200_2; B40_200_3; B40_200_4]); 
BdL0_50_200 = mean([B50_200_1; B50_200_2; B50_200_3; B50_200_4]);  std_50_200 = std([B50_200_1; B50_200_2; B50_200_3; B50_200_4]); 
BdL0_100_200 = mean([B100_200_1; B100_200_2; B100_200_3; B100_200_4]);  std_100_200 = std([B100_200_1; B100_200_2; B100_200_3; B100_200_4]); 
BdL0_150_200 = mean([B150_200_1; B150_200_2; B150_200_3; B150_200_4]);  std_150_200 = std([B150_200_1; B150_200_2; B150_200_3; B150_200_4]); 
BdL0_200_200 = mean([B200_200_1; B200_200_2; B200_200_3; B200_200_4]);  std_200_200 = std([B200_200_1; B200_200_2; B200_200_3; B200_200_4]); 
BdL0_250_200 = mean([B250_200_1;  B250_200_4]);  std_250_200 = std([B250_200_1;  B250_200_4]); 
BdL0_276_200 = mean([B276_200_1;  B276_200_4]);  std_276_200 = std([B276_200_1; B276_200_4]); 

BdL0_40_500 = mean([B40_500_1; B40_500_2; B40_500_3; B40_500_4]);  std_40_500 = std([B40_500_1; B40_500_2; B40_500_3; B40_500_4]); 
BdL0_50_500 = mean([B50_500_1; B50_500_2; B50_500_3; B50_500_4]);  std_50_500 = std([B50_500_1; B50_500_2; B50_500_3; B50_500_4]); 
BdL0_100_500 = mean([B100_500_1; B100_500_2; B100_500_3; B100_500_4]);  std_100_500 = std([B100_500_1; B100_500_2; B100_500_3; B100_500_4]); 
BdL0_150_500 = mean([B150_500_1; B150_500_2; B150_500_3; B150_500_4]);  std_150_500 = std([B150_500_1; B150_500_2; B150_500_3; B150_500_4]); 
BdL0_200_500 = mean([B200_500_1; B200_500_2; B200_500_3; B200_500_4]);  std_200_500 = std([B200_500_1; B200_500_2; B200_500_3; B200_500_4]); 
BdL0_250_500 = mean([B250_500_1; B250_500_2; B250_500_3; B250_500_4]);  std_250_500 = std([B250_500_1; B250_500_2; B250_500_3; B250_500_4]); 
BdL0_276_500 = mean([B276_500_1; B276_500_2; B276_500_3; B276_500_4]);  std_276_500 = std([B276_500_1; B276_500_2; B276_500_3; B276_500_4]); 

BdL0_40_900 = mean([B40_900_1; B40_900_2; B40_900_3; B40_900_4]);  std_40_900 = std([B40_900_1; B40_900_2; B40_900_3; B40_900_4]); 
BdL0_50_900 = mean([B50_900_1; B50_900_2; B50_900_3; B50_900_4]);  std_50_900 = std([B50_900_1; B50_900_2; B50_900_3; B50_900_4]); 
BdL0_100_900 = mean([B100_900_1; B100_900_2; B100_900_3; B100_900_4]);  std_100_900 = std([B100_900_1; B100_900_2; B100_900_3; B100_900_4]); 
BdL0_150_900 = mean([B150_900_1; B150_900_2; B150_900_3; B150_900_4]);  std_150_900 = std([B150_900_1; B150_900_2; B150_900_3; B150_900_4]); 
BdL0_200_900 = mean([B200_900_1; B200_900_2; B200_900_3; B200_900_4]);  std_200_900 = std([B200_900_1; B200_900_2; B200_900_3; B200_900_4]); 
BdL0_250_900 = mean([B250_900_1; B250_900_2; B250_900_3; B250_900_4]);  std_250_900 = std([B250_900_1; B250_900_2; B250_900_3; B250_900_4]); 
BdL0_276_900 = mean([B276_900_1;  B276_900_4]);  std_276_900 = std([B276_900_1; B276_900_4]); 

Amp = [40; 50; 100; 150; 200; 250; 276];
BdL0_100 = [BdL0_40_100; BdL0_50_100; BdL0_100_100; BdL0_150_100; BdL0_200_100; BdL0_250_100; BdL0_276_100];
BdL0_200 = [BdL0_40_200; BdL0_50_200; BdL0_100_200; BdL0_150_200; BdL0_200_200; BdL0_250_200; BdL0_276_200];
BdL0_500 = [BdL0_40_500; BdL0_50_500; BdL0_100_500; BdL0_150_500; BdL0_200_500; BdL0_250_500; BdL0_276_500];
BdL0_900 = [BdL0_40_900; BdL0_50_900; BdL0_100_900; BdL0_150_900; BdL0_200_900; BdL0_250_900; BdL0_276_900];
err_100 = [std_40_100; std_50_100; std_100_100; std_150_100; std_200_100; std_250_100; std_276_100];
err_200 = [std_40_200; std_50_200; std_100_200; std_150_200; std_200_200; std_250_200; std_276_200];
err_500 = [std_40_500; std_50_500; std_100_500; std_150_500; std_200_500; std_250_500; std_276_500];
err_900 = [std_40_900; std_50_900; std_100_900; std_150_900; std_200_900; std_250_900; std_276_900];
% plot(Amp, BdL0_100, 'bx-', Amp, BdL0_200, 'rx-', Amp, BdL0_500, 'gx-', Amp, BdL0_900, 'mx-')
%% Plots
figure;
errorbar(Amp, BdL0_100, err_100, 'bo'); hold on;
errorbar(Amp, BdL0_200, err_200, 'mo'); hold on;
errorbar(Amp, BdL0_500, err_500, 'ro'); hold on;
errorbar(Amp, BdL0_900, err_900, 'go'); hold on;
BdL0 = [BdL0_100; BdL0_200; BdL0_500; BdL0_900];
Amplit = [Amp; Amp; Amp; Amp];
pfit = polyfit(Amplit,BdL0, 1);
curr = linspace(0,300, 300);
peq = (pfit(1)*curr)+pfit(2);
plot(curr, peq, 'k--', 'LineWidth', 1);
lgd = legend('100 A/s', '200 A/s', '500 A/s', '900 A/s', 'Best fit', 'Location', 'northwest');
lgd.NumColumns = 1;
h2 = xlabel('$I_\mathrm{p}$ [A]','interpreter','latex');
set(gca,'FontName','Palatino Linotype');
 xlim([0 280]);
est = pfit(2)+(pfit(1)*(276))